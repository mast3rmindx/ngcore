syntax = "proto3";

package ngtypes;
option go_package = "github.com/ngchain/ngcore/ngtypes";

import "github.com/gogo/protobuf/gogoproto/gogo.proto";

message Account {
    uint64 ID = 1;
    bytes owner = 2; // pk -> balance in anonymous fields
    uint64 nonce = 4;
    bytes state = 5;
}

message BlockHeader {
    int32 version = 1;
    uint64 height = 2;

    bytes prev_block_hash = 3;
    bytes prev_vault_hash = 4;
    bytes trie_hash = 5;

    int64 timestamp = 6;
    bytes target = 7;
    bytes nonce = 8;
}

message Block {
    int32 network_id = 1;
    BlockHeader header = 2;
    repeated Tx txs = 3; // miner should build the generation by themselves
}

enum TxType {
    TX_INVALID = 0;
    TX_GENERATION = 1;
    TX_REGISTER = 2;
    TX_LOGOUT = 3;

    TX_TRANSACTION = 10;

    TX_ASSIGN = 20;
    TX_APPEND = 21;
}

message TxHeader {
    int32 version = 1;
    TxType type = 2;

    uint64 convener = 3; // account id required
    repeated bytes participants = 4;
    bytes fee = 5;
    repeated bytes values = 6;

    uint64 nonce = 7;

    // extension
    bytes extra = 8;
}

message Tx {
    TxHeader header = 1;

    bytes r = 2;
    bytes s = 3;
}

option (gogoproto.stable_marshaler_all) = true; // !important

message Sheet {
    int32 version = 1;
    map<uint64, Account> accounts = 2;
    map<string, bytes> anonymous = 3; // map[hex(publicKey)]balance
}

message Vault {
    int32 network_id = 1;
    Sheet sheet = 2;
    uint64 height = 3;
    int64 timestamp = 4;

    bytes prev_vault_hash = 5;
}
