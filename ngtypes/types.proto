syntax = "proto3";

package ngtypes;
option go_package = "github.com/ngchain/ngcore/ngtypes";

import "github.com/gogo/protobuf/gogoproto/gogo.proto";

message Account {
    uint64 num = 1;
    bytes owner = 2; // pk -> balance in anonymous fields
    uint64 nonce = 4;

    bytes contract = 5; // separate the code and state
    bytes state = 6;
}

message BlockHeader {
    uint64 height = 1;
    int64 timestamp = 2;

    bytes prev_block_hash = 3;
    bytes sheet_hash = 4; // assemble vault into block
    bytes trie_hash = 5;

    bytes target = 6;
    bytes nonce = 7;
}

message Block {
    int32 network = 1;
    BlockHeader header = 2;
    Sheet sheet = 3;
    repeated Tx txs = 4; // miner should build the generate tx by themselves
}

enum TxType {
    TX_INVALID = 0;
    TX_GENERATE = 1;
    TX_REGISTER = 2;
    TX_LOGOUT = 3;

    TX_TRANSACTION = 10;

    TX_ASSIGN = 20;
    TX_APPEND = 21;
}

message TxHeader {
    TxType type = 1;

    uint64 convener = 2; // account num required
    repeated bytes participants = 3;
    bytes fee = 4;
    repeated bytes values = 5;

    uint64 nonce = 6;

    // extension
    bytes extra = 7;
}

message Tx {
    int32 network = 1;
    TxHeader header = 2;
    bytes sign = 3;
}

option (gogoproto.stable_marshaler_all) = true; // !important

message Sheet {
    map<uint64, Account> accounts = 2;
    map<string, bytes> anonymous = 3; // map[hex(publicKey)]balance
}

